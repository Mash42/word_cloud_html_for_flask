<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Required link tags -->
        <link rel="stylesheet" href="/static/css/bootstrap.min.css">
        <link rel="stylesheet" href="/static/css/bootstrap-grid.min.css">
        <link rel="stylesheet" href="/static/css/bootstrap-reboot.min.css">
        <link rel="stylesheet" href="/static/font/css/open-iconic-bootstrap.css">
        <link rel="stylesheet" href="/static/css/c3.min.css">
        <!-- Required script tags -->
        <script src="/static/js/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
        <script src="/static/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="/static/js/vue_2.6.12.js"></script>
        <script src="/static/js/vuejs-pagenate_2.1.0.js"></script>
        <script src="/static/js/d3.v5.min.js"></script>
        <script src="/static/js/c3.min.js"></script>
        <script src="/static/js/d3.layout.cloud.js"></script>
        <!-- My Custom script tags -->
        <script type="text/javascript">
            $(function (){
                $(".word-cloud-text").on("click", function(){
                    alert($(this).text());
                })
                $(".word-cloud-text").on("mouseover", function(){
                    $(this).addClass("cursor-pointer");
                })
                $(".word-cloud-text").on("mouseout", function(){
                    $(this).removeClass("cursor-pointer");
                })
            });
        </script>
        <style>
            .cursor-pointer {
                cursor: pointer;
            }
        </style>
        <title>ワードクラウド</title>
    </head>
    <body>
        <div class="container mt-1" id="app">
            <div class="row">
                <div class="col-12 text-center">
                    <h1>ワードクラウド for d3.js</h1>
                    <div id="wordcloud" class="w-100"></div>
                </div>
            </div>
        </div>
        <script>
            // ワードリスト
            var myWords = []
            {% for word_info in word_list %}
            myWords.push({word:"{{word_info.word}}"
                         ,size:"{{word_info.size}}"
                         ,color:"{{word_info.color}}"
                         })
            {% endfor %}
            
                // グラフの表示設定
                var margin = { top: 10, right: 10, bottom: 10, left: 10 },
                    width = 450 - margin.left - margin.right,
                    height = 300 - margin.top - margin.bottom;
            
                // svgオブジェクトの追加
                var svg = d3.select("#wordcloud").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");
            
                // インスタンスの作成
                var layout = d3.layout.cloud()
                    .size([width, height])
                    .words(myWords.map(function (d) { return { text: d.word, size: d.size, color: d.color }; }))
                    .padding(5)        //単語の距離
                    .rotate(function () { return ~~(Math.random() * 2) * 90; })
                    .fontSize(function (d) { return d.size; })      // フォントサイズ
                    .on("end", draw);
                layout.start();
            
                // 'layoutの出力を受け取り単語を描画
                function draw(words) {
                    svg.append("g").attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                        .selectAll("text")
                        .data(words)
                        .enter().append("text")
                        .style("font-size", function (d) { return d.size; })
                        .attr("fill", function (d) { return d.color;} )
                        .attr("text-anchor", "middle")
                        .style("font-family", "Impact")
                        .attr("class", "word-cloud-text")
                        .attr("transform", function (d) {
                                               return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                                           }
                        )
                        .text(function (d) { return d.text; });
                }
        </script>
    </body>
</html>